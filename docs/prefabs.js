"use strict";(()=>{function c(t,e=()=>`Unexpected state: ${String(t)}`){if(t==null)throw Error(e());return t}function R(t,e,n=()=>`Unexpected type: ${String(t)}`){if(t instanceof e)return t;throw Error(n())}function l(t,e){let n=c(t,()=>"Unexpected argument: id is null"),r=c(document.getElementById(n),()=>`Element not found: #${n}`);return e?R(r,e):r}function w(){return new Promise(t=>requestAnimationFrame(t))}function o(t){console.error(t)}async function g(t){return await(await fetch(t)).json()}var h=class{_iterator=[][Symbol.iterator]();appendee;scrollableWrapper;itemRenderer;scrollCallback=()=>{this.renderAll().catch(o)};constructor(e,n,r){if(!e.contains(n))throw Error("Wrapper element should contain appendee element");n.innerHTML="",this.appendee=n,this.scrollableWrapper=e,this.itemRenderer=r}set iterator(e){"next"in e?this._iterator=x(e):this._iterator=x(e[Symbol.iterator]()),this.appendee.innerHTML="",this.scrollableWrapper.removeEventListener("scroll",this.scrollCallback),requestAnimationFrame(()=>{this.scrollableWrapper.removeEventListener("scroll",this.scrollCallback),this.scrollableWrapper.addEventListener("scroll",this.scrollCallback,{once:!0}),k(this,()=>S(this.scrollableWrapper)).catch(o)})}async renderAll(){await k(this,()=>!1)}};async function k(t,e){for(;!e();){let n=t._iterator.next();if(d(n))break;let r=new DocumentFragment;n.value.forEach(a=>r.appendChild(t.itemRenderer(a))),t.appendee.appendChild(r),await w()}}function S(t){return t.offsetHeight+100<t.scrollHeight}function x(t,e=10){let n=null,r={next(...a){if(n)return n;let s=Array(e);for(let i=0;i<e;i++){let u=t.next(...a);d(u)?n=u:s[i]=u.value}return{done:!1,value:s}}};return"throw"in t&&(r.throw=a=>{let s=t.throw(a);return d(s)?s:{done:s.done??!1,value:[s.value]}}),"return"in t&&(r.return=a=>{let s=t.return(a);return d(s)?s:{done:s.done??!1,value:[s.value]}}),r}function d(t){return!!t.done}function M(){document.body.addEventListener("click",({target:t})=>{if(t instanceof HTMLButtonElement&&t.dataset.inputFor!=null){let e=l(t.dataset.inputFor,HTMLInputElement);e.value=c(t.dataset.inputText??t.textContent),e.dispatchEvent(new Event("input"))}})}var P=["english","german","spanish","french","italian","japanese","koreana","polish","brazilian","russian","turkish","schinese","tchinese"],C={en:"english",de:"german",es:"spanish",fr:"french",it:"italian",ja:"japanese",ko:"koreana",pl:"polish",pt:"brazilian",ru:"russian",tr:"turkish","zh-CN":"schinese","zh-TW":"tchinese"},b=class t{static DEFAULT_LANGUAGE="english";baseUrl;defaultBlocks;defaultPrefabs;#e;#t;#n;constructor(e,n){this.baseUrl=e,this.#e=f(n),this.defaultBlocks=this.fetchLabelMap(t.DEFAULT_LANGUAGE,"blocks.json"),this.defaultPrefabs=this.fetchLabelMap(t.DEFAULT_LANGUAGE,"prefabs.json"),this.#t=this.buildLabels(this.defaultBlocks,"blocks.json"),this.#n=this.buildLabels(this.defaultPrefabs,"prefabs.json")}get blocks(){return this.#t}get prefabs(){return this.#n}set language(e){e!==this.#e&&(console.log("LabelHolder set language: %s -> %s",this.#e,e),this.#e=e,this.#t=this.buildLabels(this.defaultBlocks,"blocks.json"),this.#n=this.buildLabels(this.defaultPrefabs,"prefabs.json"))}async buildLabels(e,n){return new L(await this.fetchLabelMap(this.#e,n),await e)}async fetchLabelMap(e,n){return new Map(Object.entries(await I(`${this.baseUrl}/${e}/${n}`)))}},L=class{labels;defaultLabels;constructor(e,n){this.labels=e,this.defaultLabels=n}get(e){return this.labels.get(e)??this.defaultLabels.get(e)}};function f(t){for(let e of t)for(let[n,r]of Object.entries(C))if(e.startsWith(n))return r;return b.DEFAULT_LANGUAGE}async function I(t){return(await fetch(t)).json()}var p=class{doms;listener=[];constructor(e,n){this.doms=e,this.buildSelectOptions(n),this.doms.language.addEventListener("change",()=>{this.listener.forEach(r=>{r(this.doms.language.value)?.catch(o)})})}buildSelectOptions(e){let n=new Set(Array.from(this.doms.language.options).map(a=>a.value));for(let a of P){if(n.has(a))continue;let s=document.createElement("option");s.textContent=a,this.doms.language.appendChild(s)}let r=f(e);this.doms.language.value!==r&&(this.doms.language.value=f(e),requestAnimationFrame(()=>this.doms.language.dispatchEvent(new Event("change"))))}addListener(e){this.listener.push(e)}};var m=class t{url;inputs;udpateListeners=[];constructor(e,n){this.url=e,this.inputs=new Map(Array.from(n).map(r=>[r.element,r])),this.init()}init(){for(let[e,{defaultValue:n}]of this.inputs.entries())this.url.searchParams.has(e.id)&&(F(e,this.url.searchParams.get(e.id)??n),e.dispatchEvent(new Event("input"))),e.addEventListener("input",()=>{this.updateUrl(e,n),this.udpateListeners.forEach(r=>{r(this.url)})})}static create(e,n){return new t(new URL(e.href),Array.from(n).map(r=>({defaultValue:y(r),element:r})))}updateUrl(e,n){let r=y(e);r===n?this.url.searchParams.delete(e.id):this.url.searchParams.set(e.id,r)}addUpdateListener(e){this.udpateListeners.push(e)}};function y(t){switch(t.type){case"checkbox":return t.checked?"t":"";default:return t.value}}function F(t,e){switch(t.type){case"checkbox":t.checked=e==="t";break;default:t.value=e}}function A(){M(),m.create(location,document.querySelectorAll("input")).addUpdateListener(i=>{window.history.replaceState(null,"",i.toString())});let e=new T(new Worker("worker/prefabs-filter.js"));(async()=>{let[i,u]=await Promise.all([g("prefab-block-index.json"),g("prefab-difficulties.json")]),H=Object.keys(i).map(E=>({name:E,x:0,z:0,difficulty:u[E]??0}));e.prefabs=H})().catch(o);let n=l("blocks_filter",HTMLInputElement);e.blockFilter=n.value,n.addEventListener("input",()=>{e.blockFilter=n.value}),new p({language:l("label_lang",HTMLSelectElement)},navigator.languages).addListener(i=>{e.language=i});let a=new v({devPrefabs:l("dev_prefabs",HTMLInputElement)});a.addUpdateListener(()=>{e.refresh()});let s=new h(document.body,l("prefabs_list"),i=>G(i));e.listeners.push(i=>{s.iterator=i.prefabs.filter(a.filter())})}function G(t){let e=document.createElement("li");if(e.innerHTML=[...t.difficulty?[`<span title="Difficulty Tier ${t.difficulty.toString()}" class="prefab_difficulty_${t.difficulty.toString()}">`,`  <span class="prefab_difficulty_icon">\u{1F480}</span>${t.difficulty.toString()}`,"</span>"]:[],`<a href="prefabs/${t.name}.html" target="_blank">`,t.highlightedLabel??"-","/",`<small>${t.highlightedName??t.name}</small>`,"</a>"].join(" "),t.matchedBlocks&&t.matchedBlocks.length>0){let n=document.createElement("ul");t.matchedBlocks.forEach(r=>{if(r.count===void 0)return;let a=document.createElement("li");a.innerHTML=[`<button data-input-for="blocks_filter" data-input-text="${r.name}" title="Filter with this block name">\u25B2</button>`,`${r.count.toString()}x`,r.highlightedLabel,`<small>${r.highlightedName}</small>`].join(" "),n.appendChild(a)}),e.appendChild(n)}return e}var T=class{worker;listeners=[];constructor(e){this.worker=e,this.worker.addEventListener("message",n=>{for(let r of this.listeners)r(n.data)?.catch(o)})}set prefabs(e){this.worker.postMessage({all:e})}set blockFilter(e){this.worker.postMessage({blocksFilterString:e})}set language(e){this.worker.postMessage({language:e})}refresh(){this.worker.postMessage({})}},v=class{displayDevPrefab=!1;updateListener=[];constructor(e){this.displayDevPrefab=e.devPrefabs.checked,e.devPrefabs.addEventListener("input",()=>{this.displayDevPrefab=e.devPrefabs.checked,this.updateListener.forEach(n=>{n()})})}filter(){return e=>this.displayDevPrefab?!0:!/^aaa_/i.test(e.name)}addUpdateListener(e){this.updateListener.push(e)}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",A):A();})();
//# sourceMappingURL=prefabs.js.map
