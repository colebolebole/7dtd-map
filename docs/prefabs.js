(()=>{"use strict";var e={550:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DelayedRenderer=void 0;const r=n(726);async function a(e,t){for(;!t();){const t=e._iterator.next();if(i(t))break;const n=new DocumentFragment;t.value.forEach((t=>n.appendChild(e.itemRenderer(t)))),e.appendee.appendChild(n),await(0,r.waitAnimationFrame)()}}function i(e){return Boolean(e.done)}t.DelayedRenderer=class{constructor(e,t,n){if(this._iterator=[][Symbol.iterator](),this.scrollCallback=()=>{this.renderAll()},!e.contains(t))throw Error("Wrapper element should contain appendee element");t.innerHTML="",this.appendee=t,this.scrollableWrapper=e,this.itemRenderer=n}set iterator(e){this._iterator=function(e,t=10){let n=null;const a={next(...r){if(n)return n;const a=Array(t);for(let s=0;s<t;s++){const t=e.next(...r);i(t)?n=t:a[s]=t.value}return{done:!1,value:a}}};return"throw"in e&&(a.throw=t=>{const n=(0,r.requireNonnull)(e.throw)(t);return i(n)?n:{done:n.done,value:[n.value]}}),"return"in e&&(a.return=t=>{const n=(0,r.requireNonnull)(e.return)(t);return i(n)?n:{done:n.done,value:[n.value]}}),a}("next"in e?e:e[Symbol.iterator]()),this.appendee.innerHTML="",this.scrollableWrapper.removeEventListener("scroll",this.scrollCallback),requestAnimationFrame((()=>{this.scrollableWrapper.removeEventListener("scroll",this.scrollCallback),this.scrollableWrapper.addEventListener("scroll",this.scrollCallback,{once:!0}),a(this,(()=>{return(e=this.scrollableWrapper).offsetHeight+100<e.scrollHeight;var e}))}))}async renderAll(){await a(this,(()=>!1))}}},725:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LabelHandler=void 0;const r=n(273);t.LabelHandler=class{constructor(e,t){this.listener=[],this.doms=e,this.buildSelectOptions(t),this.doms.language.addEventListener("change",(()=>{this.listener.map((e=>e(this.doms.language.value)))}))}buildSelectOptions(e){const t=new Set(Array.from(this.doms.language.options).map((e=>e.value)));for(const e of r.LANGUAGES){if(t.has(e))continue;const n=document.createElement("option");n.textContent=e,this.doms.language.appendChild(n)}this.doms.language.value=(0,r.resolveLanguage)(e)}addListener(e){this.listener.push(e)}}},273:function(e,t){var n,r,a,i=this&&this.__classPrivateFieldSet||function(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n},s=this&&this.__classPrivateFieldGet||function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.resolveLanguage=t.Labels=t.LabelHolder=t.LANGUAGES=void 0,t.LANGUAGES=["english","german","spanish","french","italian","japanese","koreana","polish","brazilian","russian","turkish","schinese","tchinese"];const o={en:"english",de:"german",es:"spanish",fr:"french",it:"italian",ja:"japanese",ko:"koreana",pl:"polish",pt:"brazilian",ru:"russian",tr:"turkish","zh-CN":"schinese","zh-TW":"tchinese"};class l{constructor(e,t){n.set(this,void 0),r.set(this,void 0),a.set(this,void 0),this.baseUrl=e,i(this,n,u(t),"f"),this.defaultBlocks=this.fetchLabelMap(l.DEFAULT_LANGUAGE,"blocks.json"),this.defaultPrefabs=this.fetchLabelMap(l.DEFAULT_LANGUAGE,"prefabs.json"),i(this,r,this.buildLabels(this.defaultBlocks,"blocks.json"),"f"),i(this,a,this.buildLabels(this.defaultPrefabs,"prefabs.json"),"f")}get blocks(){return s(this,r,"f")}get prefabs(){return s(this,a,"f")}set language(e){e!==s(this,n,"f")&&(console.log("LabelHolder set language: %s -> %s",s(this,n,"f"),e),i(this,n,e,"f"),i(this,r,this.buildLabels(this.defaultBlocks,"blocks.json"),"f"),i(this,a,this.buildLabels(this.defaultPrefabs,"prefabs.json"),"f"))}async buildLabels(e,t){return new c(await this.fetchLabelMap(s(this,n,"f"),t),await e)}async fetchLabelMap(e,t){return new Map(Object.entries(await async function(e){return(await fetch(e)).json()}(`${this.baseUrl}/${e}/${t}`)))}}t.LabelHolder=l,n=new WeakMap,r=new WeakMap,a=new WeakMap,l.DEFAULT_LANGUAGE="english";class c{constructor(e,t){this.labels=e,this.defaultLabels=t}get(e){return this.labels.get(e)??this.defaultLabels.get(e)}}function u(e){for(const t of e)for(const[e,n]of Object.entries(o))if(t.startsWith(e))return n;return l.DEFAULT_LANGUAGE}t.Labels=c,t.resolveLanguage=u},110:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.init=void 0;const r=n(726);t.init=function(){document.body.addEventListener("click",(({target:e})=>{if(e instanceof HTMLButtonElement&&null!=e.dataset.inputFor){const t=(0,r.component)(e.dataset.inputFor,HTMLInputElement);t.value=(0,r.requireNonnull)(e.dataset.inputText??e.textContent),t.dispatchEvent(new Event("input"))}}))}},726:(e,t)=>{function n(e,t=(()=>`Unexpected state: ${e}`)){if(null!=e)return e;throw Error(t())}function r(e,t,n=(()=>`Unexpected type: ${e}`)){if(e instanceof t)return e;throw Error(n())}function a(e){return{type:"game",...e}}function i(e,t,n){const r=e.offsetX*t.width/n.width,i=e.offsetY*t.height/n.height;if(r<0||r>=t.width||i<0||i>=t.height)return null;const s=r-Math.floor(t.width/2),o=Math.floor(t.height/2)-i;return a({x:Math.round(s),z:Math.round(o)})}Object.defineProperty(t,"__esModule",{value:!0}),t.threePlaneSize=t.canvasEventToGameCoords=t.gameCoords=t.gameMapSize=t.sleep=t.imageBitmapToPngBlob=t.downloadCanvasPng=t.formatCoords=t.waitAnimationFrame=t.humanreadableDistance=t.removeAllChildren=t.component=t.requireType=t.requireNonnull=void 0,t.requireNonnull=n,t.requireType=r,t.component=function(e,t){const a=n(document.getElementById(n(e,(()=>`Element ID must not null: ${e}`))),(()=>`Element not found: #${e}`));return t?r(a,t):a},t.removeAllChildren=function(e){for(;e.lastChild;)e.removeChild(e.lastChild)},t.humanreadableDistance=function(e){return e<1e3?`${e}m`:`${(e/1e3).toFixed(2)}km`},t.waitAnimationFrame=function(){return new Promise((e=>requestAnimationFrame(e)))},t.formatCoords=function(e,t,n,r){if(!r)return"E/W: -, N/S: -, Elev: -";const a=i(r,e,t);if(null===a)return"E/W: -, N/S: -, Elev: -";const s=n(a,e)??"-";return`E/W: ${a.x}, N/S: ${a.z}, Elev: ${s}`},t.downloadCanvasPng=function(e,t){const n=document.createElement("a");n.download=e,n.href=t.toDataURL("image/png"),n.click()},t.imageBitmapToPngBlob=async function(e){const t=new OffscreenCanvas(e.height,e.width);return n(t.getContext("2d")).drawImage(e,0,0),await t.convertToBlob({type:"image/png"})},t.sleep=async function(e){return new Promise((t=>setTimeout(t,e)))},t.gameMapSize=function(e){return{type:"game",...e}},t.gameCoords=a,t.canvasEventToGameCoords=i,t.threePlaneSize=function(e,t){return{type:"threePlane",width:e,height:t}}},19:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const s=n(550),o=i(n(110)),l=n(726),c=n(725);function u(){o.init();const e=new d(new Worker("worker/prefabs-filter.js"));(0,l.component)("blocks_filter",HTMLInputElement).addEventListener("input",(t=>{e.blockFilter=t.target.value})),(async()=>{const[t,n]=await Promise.all([fetch("prefab-block-index.json").then((e=>e.json())),fetch("prefab-difficulties.json").then((e=>e.json()))]),r=Object.keys(t).map((e=>({name:e,x:0,z:0,difficulty:n[e]})));e.prefabs=r})(),new c.LabelHandler({language:(0,l.component)("label_lang",HTMLSelectElement)},navigator.languages).addListener((async t=>{e.language=t}));const t=new s.DelayedRenderer(document.body,(0,l.component)("prefabs_list"),(e=>function(e){const t=document.createElement("li");if(t.innerHTML=[e.difficulty&&e.difficulty>0?`<span title="Difficulty Tier ${e.difficulty}" class="prefab_difficulty_${e.difficulty}"><span class="prefab_difficulty_icon">ðŸ’€</span>${e.difficulty}</span>`:"",`<a href="prefabs/${e.name}.html" target="_blank">`,e.highlightedLabel||"-","/",`<small>${e.highlightedName||e.name}</small>`,"</a>"].join(" "),e.matchedBlocks&&e.matchedBlocks.length>0){const n=document.createElement("ul");e.matchedBlocks.forEach((e=>{const t=document.createElement("li");t.innerHTML=[`<button data-input-for="blocks_filter" data-input-text="${e.name}" title="Filter with this block name">â–²</button>`,`${e.count}x`,e.highlightedLabel,`<small>${e.highlightedName}</small>`].join(" "),n.appendChild(t)})),t.appendChild(n)}return t}(e)));e.listeners.push((async e=>{t.iterator=e.prefabs}))}class d{constructor(e){this.listeners=[],this.worker=e,this.worker.addEventListener("message",(e=>{this.listeners.map((t=>t(e.data)))}))}set prefabs(e){this.worker.postMessage({all:e})}set blockFilter(e){this.worker.postMessage({blocksFilterString:e})}set language(e){this.worker.postMessage({language:e})}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",u):u()}},t={};!function n(r){var a=t[r];if(void 0!==a)return a.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}(19)})();
//# sourceMappingURL=prefabs.js.map