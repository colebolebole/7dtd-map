(()=>{"use strict";var e={550:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DelayedRenderer=void 0;const a=n(726);async function r(e,t){for(;!t();){const t=e._iterator.next();if(i(t))break;const n=new DocumentFragment;t.value.forEach((t=>n.appendChild(e.itemRenderer(t)))),e.appendee.appendChild(n),await(0,a.waitAnimationFrame)()}}function i(e){return Boolean(e.done)}t.DelayedRenderer=class{constructor(e,t,n){if(this._iterator=[][Symbol.iterator](),this.scrollCallback=()=>{this.renderAll()},!e.contains(t))throw Error("Wrapper element should contain appendee element");t.innerHTML="",this.appendee=t,this.scrollableWrapper=e,this.itemRenderer=n}set iterator(e){this._iterator=function(e,t=10){let n=null;const r={next(...a){if(n)return n;const r=Array(t);for(let s=0;s<t;s++){const t=e.next(...a);i(t)?n=t:r[s]=t.value}return{done:!1,value:r}}};return"throw"in e&&(r.throw=t=>{const n=(0,a.requireNonnull)(e.throw)(t);return i(n)?n:{done:n.done,value:[n.value]}}),"return"in e&&(r.return=t=>{const n=(0,a.requireNonnull)(e.return)(t);return i(n)?n:{done:n.done,value:[n.value]}}),r}("next"in e?e:e[Symbol.iterator]()),this.appendee.innerHTML="",this.scrollableWrapper.removeEventListener("scroll",this.scrollCallback),requestAnimationFrame((()=>{this.scrollableWrapper.removeEventListener("scroll",this.scrollCallback),this.scrollableWrapper.addEventListener("scroll",this.scrollCallback,{once:!0}),r(this,(()=>{return(e=this.scrollableWrapper).offsetHeight+100<e.scrollHeight;var e}))}))}async renderAll(){await r(this,(()=>!1))}}},725:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LabelHandler=void 0;const a=n(273);t.LabelHandler=class{constructor(e,t){this.listener=[],this.doms=e,this.buildSelectOptions(t),this.doms.language.addEventListener("change",(()=>{this.listener.map((e=>e(this.doms.language.value)))}))}buildSelectOptions(e){const t=new Set(Array.from(this.doms.language.options).map((e=>e.value)));for(const e of a.LANGUAGES){if(t.has(e))continue;const n=document.createElement("option");n.textContent=e,this.doms.language.appendChild(n)}const n=(0,a.resolveLanguage)(e);this.doms.language.value!==n&&(this.doms.language.value=(0,a.resolveLanguage)(e),requestAnimationFrame((()=>this.doms.language.dispatchEvent(new Event("change")))))}addListener(e){this.listener.push(e)}}},273:function(e,t){var n,a,r,i=this&&this.__classPrivateFieldSet||function(e,t,n,a,r){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(e,n):r?r.value=n:t.set(e,n),n},s=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.resolveLanguage=t.Labels=t.LabelHolder=t.LANGUAGES=void 0,t.LANGUAGES=["english","german","spanish","french","italian","japanese","koreana","polish","brazilian","russian","turkish","schinese","tchinese"];const o={en:"english",de:"german",es:"spanish",fr:"french",it:"italian",ja:"japanese",ko:"koreana",pl:"polish",pt:"brazilian",ru:"russian",tr:"turkish","zh-CN":"schinese","zh-TW":"tchinese"};class l{constructor(e,t){n.set(this,void 0),a.set(this,void 0),r.set(this,void 0),this.baseUrl=e,i(this,n,u(t),"f"),this.defaultBlocks=this.fetchLabelMap(l.DEFAULT_LANGUAGE,"blocks.json"),this.defaultPrefabs=this.fetchLabelMap(l.DEFAULT_LANGUAGE,"prefabs.json"),i(this,a,this.buildLabels(this.defaultBlocks,"blocks.json"),"f"),i(this,r,this.buildLabels(this.defaultPrefabs,"prefabs.json"),"f")}get blocks(){return s(this,a,"f")}get prefabs(){return s(this,r,"f")}set language(e){e!==s(this,n,"f")&&(console.log("LabelHolder set language: %s -> %s",s(this,n,"f"),e),i(this,n,e,"f"),i(this,a,this.buildLabels(this.defaultBlocks,"blocks.json"),"f"),i(this,r,this.buildLabels(this.defaultPrefabs,"prefabs.json"),"f"))}async buildLabels(e,t){return new c(await this.fetchLabelMap(s(this,n,"f"),t),await e)}async fetchLabelMap(e,t){return new Map(Object.entries(await async function(e){return(await fetch(e)).json()}(`${this.baseUrl}/${e}/${t}`)))}}t.LabelHolder=l,n=new WeakMap,a=new WeakMap,r=new WeakMap,l.DEFAULT_LANGUAGE="english";class c{constructor(e,t){this.labels=e,this.defaultLabels=t}get(e){return this.labels.get(e)??this.defaultLabels.get(e)}}function u(e){for(const t of e)for(const[e,n]of Object.entries(o))if(t.startsWith(e))return n;return l.DEFAULT_LANGUAGE}t.Labels=c,t.resolveLanguage=u},110:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.init=void 0;const a=n(726);t.init=function(){document.body.addEventListener("click",(({target:e})=>{if(e instanceof HTMLButtonElement&&null!=e.dataset.inputFor){const t=(0,a.component)(e.dataset.inputFor,HTMLInputElement);t.value=(0,a.requireNonnull)(e.dataset.inputText??e.textContent),t.dispatchEvent(new Event("input"))}}))}},959:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UrlState=void 0;class n{constructor(e,t){this.udpateListeners=[],this.url=e,this.inputs=new Map(Array.from(t).map((e=>[e.element,e]))),this.init()}init(){for(const[e,{defaultValue:t}]of this.inputs.entries())this.url.searchParams.has(e.id)&&(r(e,this.url.searchParams.get(e.id)??t),e.dispatchEvent(new Event("input"))),e.addEventListener("input",(()=>{this.updateUrl(e,t),this.udpateListeners.forEach((e=>e(this.url)))}))}static create(e,t){return new n(new URL(e.href),Array.from(t).map((e=>({defaultValue:a(e),element:e}))))}updateUrl(e,t){const n=a(e);n===t?this.url.searchParams.delete(e.id):this.url.searchParams.set(e.id,n)}addUpdateListener(e){this.udpateListeners.push(e)}}function a(e){return"checkbox"===e.type?e.checked?"t":"":e.value}function r(e,t){"checkbox"===e.type?e.checked="t"===t:e.value=t}t.UrlState=n},726:(e,t)=>{function n(e,t=(()=>`Unexpected state: ${e}`)){if(null!=e)return e;throw Error(t())}function a(e,t,n=(()=>`Unexpected type: ${e}`)){if(e instanceof t)return e;throw Error(n())}function r(e){return{type:"game",...e}}function i(e,t,n){const a=e.offsetX*t.width/n.width,i=e.offsetY*t.height/n.height;if(a<0||a>=t.width||i<0||i>=t.height)return null;const s=a-Math.floor(t.width/2),o=Math.floor(t.height/2)-i;return r({x:Math.round(s),z:Math.round(o)})}Object.defineProperty(t,"__esModule",{value:!0}),t.threePlaneSize=t.canvasEventToGameCoords=t.gameCoords=t.gameMapSize=t.sleep=t.imageBitmapToPngBlob=t.downloadCanvasPng=t.formatCoords=t.waitAnimationFrame=t.humanreadableDistance=t.removeAllChildren=t.component=t.requireType=t.requireNonnull=void 0,t.requireNonnull=n,t.requireType=a,t.component=function(e,t){const r=n(document.getElementById(n(e,(()=>`Element ID must not null: ${e}`))),(()=>`Element not found: #${e}`));return t?a(r,t):r},t.removeAllChildren=function(e){for(;e.lastChild;)e.removeChild(e.lastChild)},t.humanreadableDistance=function(e){return e<1e3?`${e}m`:`${(e/1e3).toFixed(2)}km`},t.waitAnimationFrame=function(){return new Promise((e=>requestAnimationFrame(e)))},t.formatCoords=function(e,t,n,a){if(!a)return"E/W: -, N/S: -, Elev: -";const r=i(a,e,t);if(null===r)return"E/W: -, N/S: -, Elev: -";const s=n(r,e)??"-";return`E/W: ${r.x}, N/S: ${r.z}, Elev: ${s}`},t.downloadCanvasPng=function(e,t){const n=document.createElement("a");n.download=e,n.href=t.toDataURL("image/png"),n.click()},t.imageBitmapToPngBlob=async function(e){const t=new OffscreenCanvas(e.height,e.width);return n(t.getContext("2d")).drawImage(e,0,0),await t.convertToBlob({type:"image/png"})},t.sleep=async function(e){return new Promise((t=>setTimeout(t,e)))},t.gameMapSize=function(e){return{type:"game",...e}},t.gameCoords=r,t.canvasEventToGameCoords=i,t.threePlaneSize=function(e,t){return{type:"threePlane",width:e,height:t}}},19:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const s=n(550),o=i(n(110)),l=n(726),c=n(725),u=n(959);function d(){o.init(),u.UrlState.create(location,document.querySelectorAll("input")).addUpdateListener((e=>window.history.replaceState(null,"",e.toString())));const e=new h(new Worker("worker/prefabs-filter.js"));(async()=>{const[t,n]=await Promise.all([fetch("prefab-block-index.json").then((e=>e.json())),fetch("prefab-difficulties.json").then((e=>e.json()))]),a=Object.keys(t).map((e=>({name:e,x:0,z:0,difficulty:n[e]})));e.prefabs=a})();const t=(0,l.component)("blocks_filter",HTMLInputElement);e.blockFilter=t.value,t.addEventListener("input",(()=>{e.blockFilter=t.value})),new c.LabelHandler({language:(0,l.component)("label_lang",HTMLSelectElement)},navigator.languages).addListener((async t=>{e.language=t}));const n=new f({devPrefabs:(0,l.component)("dev_prefabs",HTMLInputElement)});n.addUpdateListener((()=>{e.refresh()}));const a=new s.DelayedRenderer(document.body,(0,l.component)("prefabs_list"),(e=>function(e){const t=document.createElement("li");if(t.innerHTML=[e.difficulty&&e.difficulty>0?`<span title="Difficulty Tier ${e.difficulty}" class="prefab_difficulty_${e.difficulty}"><span class="prefab_difficulty_icon">ðŸ’€</span>${e.difficulty}</span>`:"",`<a href="prefabs/${e.name}.html" target="_blank">`,e.highlightedLabel||"-","/",`<small>${e.highlightedName||e.name}</small>`,"</a>"].join(" "),e.matchedBlocks&&e.matchedBlocks.length>0){const n=document.createElement("ul");e.matchedBlocks.forEach((e=>{const t=document.createElement("li");t.innerHTML=[`<button data-input-for="blocks_filter" data-input-text="${e.name}" title="Filter with this block name">â–²</button>`,`${e.count}x`,e.highlightedLabel,`<small>${e.highlightedName}</small>`].join(" "),n.appendChild(t)})),t.appendChild(n)}return t}(e)));e.listeners.push((async e=>{a.iterator=e.prefabs.filter(n.filter())}))}class h{constructor(e){this.listeners=[],this.worker=e,this.worker.addEventListener("message",(e=>{this.listeners.map((t=>t(e.data)))}))}set prefabs(e){this.worker.postMessage({all:e})}set blockFilter(e){this.worker.postMessage({blocksFilterString:e})}set language(e){this.worker.postMessage({language:e})}refresh(){this.worker.postMessage({})}}class f{constructor(e){this.displayDevPrefab=!1,this.updateListener=[],this.displayDevPrefab=e.devPrefabs.checked,e.devPrefabs.addEventListener("input",(()=>{this.displayDevPrefab=e.devPrefabs.checked,this.updateListener.forEach((e=>e()))}))}filter(){return e=>!!this.displayDevPrefab||!/^aaa_/i.test(e.name)}addUpdateListener(e){this.updateListener.push(e)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",d):d()}},t={};!function n(a){var r=t[a];if(void 0!==r)return r.exports;var i=t[a]={exports:{}};return e[a].call(i.exports,i,i.exports,n),i.exports}(19)})();
//# sourceMappingURL=prefabs.js.map