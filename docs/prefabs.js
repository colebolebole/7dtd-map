"use strict";(()=>{function d(t,e=()=>`Unexpected state: ${String(t)}`){if(t==null)throw Error(e());return t}function R(t,e,n=()=>`Unexpected type: ${String(t)}`){if(t instanceof e)return t;throw Error(n())}function l(t,e){let n=d(t,()=>"Unexpected argument: id is null"),r=d(document.getElementById(n),()=>`Element not found: #${n}`);return e?R(r,e):r}function w(){return new Promise(t=>requestAnimationFrame(t))}function o(t){console.error(t)}async function c(t){return await(await fetch(t)).json()}var m=class{_iterator=[][Symbol.iterator]();appendee;scrollableWrapper;itemRenderer;scrollCallback=()=>{this.renderAll().catch(o)};constructor(e,n,r){if(!e.contains(n))throw Error("Wrapper element should contain appendee element");n.innerHTML="",this.appendee=n,this.scrollableWrapper=e,this.itemRenderer=r}set iterator(e){"next"in e?this._iterator=M(e):this._iterator=M(e[Symbol.iterator]()),this.appendee.innerHTML="",this.scrollableWrapper.removeEventListener("scroll",this.scrollCallback),requestAnimationFrame(()=>{this.scrollableWrapper.removeEventListener("scroll",this.scrollCallback),this.scrollableWrapper.addEventListener("scroll",this.scrollCallback,{once:!0}),k(this,()=>F(this.scrollableWrapper)).catch(o)})}async renderAll(){await k(this,()=>!1)}};async function k(t,e){for(;!e();){let n=t._iterator.next();if(h(n))break;let r=new DocumentFragment;n.value.forEach(a=>r.appendChild(t.itemRenderer(a))),t.appendee.appendChild(r),await w()}}function F(t){return t.offsetHeight+100<t.scrollHeight}function M(t,e=10){let n=null,r={next(...a){if(n)return n;let i=Array(e);for(let s=0;s<e;s++){let u=t.next(...a);h(u)?n=u:i[s]=u.value}return{done:!1,value:i}}};return"throw"in t&&(r.throw=a=>{let i=t.throw(a);return h(i)?i:{done:i.done??!1,value:[i.value]}}),"return"in t&&(r.return=a=>{let i=t.return(a);return h(i)?i:{done:i.done??!1,value:[i.value]}}),r}function h(t){return!!t.done}function x(){document.body.addEventListener("click",({target:t})=>{if(t instanceof HTMLButtonElement&&t.dataset.inputFor!=null){let e=l(t.dataset.inputFor,HTMLInputElement);e.value=d(t.dataset.inputText??t.textContent),e.dispatchEvent(new Event("input"))}})}var P=["english","german","spanish","french","italian","japanese","koreana","polish","brazilian","russian","turkish","schinese","tchinese"],U={en:"english",de:"german",es:"spanish",fr:"french",it:"italian",ja:"japanese",ko:"koreana",pl:"polish",pt:"brazilian",ru:"russian",tr:"turkish","zh-CN":"schinese","zh-TW":"tchinese"},y=["blocks","prefabs","shapes"],b=class t{static DEFAULT_LANGUAGE="english";#t;#e;#r;#n;constructor(e,n){this.#t=e,this.#e=f(n),this.#r=new Map(y.map(r=>[r,this.#i(t.DEFAULT_LANGUAGE,r)])),this.#n=this.#a()}get(e){let n=this.#n.get(e);if(!n)throw new Error(`No labels for ${this.#e}/${e}`);return n}set language(e){e!==this.#e&&(console.log("LabelHolder set language: %s -> %s",this.#e,e),this.#e=e,this.#n=this.#a())}#a(){return new Map(y.map(e=>[e,this.#s(e)]))}async#s(e){let n=this.#r.get(e);if(!n)throw new Error(`No fallback for ${this.#e}/${e}`);return new L(await this.#i(this.#e,e),await n)}async#i(e,n){return new Map(Object.entries(await c(`${this.#t}/${e}/${n}.json`)))}},L=class{#t;#e;constructor(e,n){this.#t=e,this.#e=n}get(e){return this.#t.get(e)??this.#e.get(e)}};function f(t){for(let e of t)for(let[n,r]of Object.entries(U))if(e.startsWith(n))return r;return b.DEFAULT_LANGUAGE}var p=class{doms;listener=[];constructor(e,n){this.doms=e,this.buildSelectOptions(n),this.doms.language.addEventListener("change",()=>{this.listener.forEach(r=>{r(this.doms.language.value)?.catch(o)})})}buildSelectOptions(e){let n=new Set(Array.from(this.doms.language.options).map(a=>a.value));for(let a of P){if(n.has(a))continue;let i=document.createElement("option");i.textContent=a,this.doms.language.appendChild(i)}let r=f(e);this.doms.language.value!==r&&(this.doms.language.value=f(e),requestAnimationFrame(()=>this.doms.language.dispatchEvent(new Event("change"))))}addListener(e){this.listener.push(e)}};var g=class t{url;inputs;udpateListeners=[];constructor(e,n){this.url=e,this.inputs=new Map(Array.from(n).map(r=>[r.element,r])),this.init()}init(){for(let[e,{defaultValue:n}]of this.inputs.entries())this.url.searchParams.has(e.id)&&(C(e,this.url.searchParams.get(e.id)??n),e.dispatchEvent(new Event("input"))),e.addEventListener("input",()=>{this.updateUrl(e,n),this.udpateListeners.forEach(r=>{r(this.url)})})}static create(e,n){return new t(new URL(e.href),Array.from(n).map(r=>({defaultValue:S(r),element:r})))}updateUrl(e,n){let r=S(e);r===n?this.url.searchParams.delete(e.id):this.url.searchParams.set(e.id,r)}addUpdateListener(e){this.udpateListeners.push(e)}};function S(t){switch(t.type){case"checkbox":return t.checked?"t":"";default:return t.value}}function C(t,e){switch(t.type){case"checkbox":t.checked=e==="t";break;default:t.value=e}}function A(){x(),g.create(location,document.querySelectorAll("input")).addUpdateListener(s=>{window.history.replaceState(null,"",s.toString())});let e=new T(new Worker("worker/prefabs-filter.js"));(async()=>{let[s,u]=await Promise.all([c("prefab-block-counts.json"),c("prefab-difficulties.json")]),H=Object.keys(s).map(v=>({name:v,x:0,z:0,difficulty:u[v]??0}));e.prefabs=H})().catch(o);let n=l("blocks_filter",HTMLInputElement);e.blockFilter=n.value,n.addEventListener("input",()=>{e.blockFilter=n.value}),new p({language:l("label_lang",HTMLSelectElement)},navigator.languages).addListener(s=>{e.language=s});let a=new E({devPrefabs:l("dev_prefabs",HTMLInputElement)});a.addUpdateListener(()=>{e.refresh()});let i=new m(document.body,l("prefabs_list"),s=>B(s));e.listeners.push(s=>{i.iterator=s.prefabs.filter(a.filter())})}function B(t){let e=document.createElement("li");if(e.innerHTML=[...t.difficulty?[`<span title="Difficulty Tier ${t.difficulty.toString()}" class="prefab_difficulty_${t.difficulty.toString()}">`,`  \u{1F480}${t.difficulty.toString()}`,"</span>"]:[],`<a href="prefabs/${t.name}.html" target="_blank">`,t.highlightedLabel??"-","/",`<small>${t.highlightedName??t.name}</small></a>`,...t.matchedBlocks&&t.matchedBlocks.length>0?["has",I(t.matchedBlocks),"blocks"]:[]].join(" "),t.matchedBlocks&&t.matchedBlocks.length>0){let n=document.createElement("ul");t.matchedBlocks.forEach(r=>{if(r.count===void 0)return;let a=document.createElement("li");a.innerHTML=[`<button data-input-for="blocks_filter" data-input-text="${r.name}" title="Filter with this block name">\u25B2</button>`,`${r.count.toString()}x`,r.highlightedLabel,`<small>${r.highlightedName}</small>`].join(" "),n.appendChild(a)}),e.appendChild(n)}return e}function I(t){return t.reduce((e,n)=>e+(n.count??0),0)}var T=class{worker;listeners=[];constructor(e){this.worker=e,this.worker.addEventListener("message",n=>{for(let r of this.listeners)r(n.data)?.catch(o)})}set prefabs(e){this.worker.postMessage({all:e})}set blockFilter(e){this.worker.postMessage({blocksFilterString:e})}set language(e){this.worker.postMessage({language:e})}refresh(){this.worker.postMessage({})}},E=class{displayDevPrefab=!1;updateListener=[];constructor(e){this.displayDevPrefab=e.devPrefabs.checked,e.devPrefabs.addEventListener("input",()=>{this.displayDevPrefab=e.devPrefabs.checked,this.updateListener.forEach(n=>{n()})})}filter(){return e=>this.displayDevPrefab?!0:!/^aaa_/i.test(e.name)}addUpdateListener(e){this.updateListener.push(e)}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",A):A();})();
//# sourceMappingURL=prefabs.js.map
