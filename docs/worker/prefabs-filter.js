(()=>{"use strict";var t={17:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const a=s(847);function n(t,e){return t.name>e.name?1:t.name<e.name?-1:0}function r(t,e){return t.dist&&e.dist?t.dist>e.dist?1:t.dist<e.dist?-1:n(t,e):n(t,e)}function i(t,e){let s=!1;const a=t.replace(e,(t=>(s=t.length>0,`<mark>${t}</mark>`)));return s?a:null}e.default=class{constructor(){this.all=[],this.prefabLabels={},this.blockLabels={},this.blockPrefabIndex={},this.filter=null,this.filtered=[],this.markCoords=null,this.status="",this.throttledUpdater=(0,a.throttledInvoker)((async()=>this.updateImmediately())),this.updateListeners=[]}update(){this.throttledUpdater()}updateImmediately(){this.applyFilter(),this.updateDist(),this.sort();const t={status:this.status,prefabs:this.filtered};this.updateListeners.forEach((e=>e(t)))}set prefabsFilterString(t){const e=t.trim();0===e.length?this.filter=null:this.filter=new l(new RegExp(e,"i"),this.prefabLabels)}set blocksFilterString(t){const e=t.trim();0===e.length?this.filter=null:this.filter=new o(new RegExp(e,"i"),this.blockPrefabIndex,this.blockLabels)}addUpdateListener(t){this.updateListeners.push(t)}applyFilter(){if(this.initPrefabLabels(),this.filter){const t=this.filter.match(this.all);this.status=t.status,this.filtered=t.matched}else 0===this.all.length?(this.status="No prefabs",this.filtered=[]):(this.status="All prefabs",this.filtered=this.all)}initPrefabLabels(){if(0!==this.all.length&&!("label"in this.all[0])&&0!==Object.keys(this.prefabLabels).length)for(const t of this.all)t.label=this.prefabLabels[t.name]}updateDist(){if(this.markCoords){const{markCoords:t}=this;this.filtered.forEach((e=>{return e.dist=(s=e,a=t,Math.round(Math.sqrt((s.x-a.x)**2+(s.z-a.z)**2)));var s,a}))}else this.filtered.forEach((t=>t.dist=null))}sort(){this.markCoords?(this.status=`${this.status}, order by distances from the flag`,this.filtered.sort(r)):this.filtered.sort(n)}};class l{constructor(t,e){this.regexp=t,this.labels=e}match(t){const e=t.flatMap((t=>{const e=i(t.name,this.regexp),s=t.label&&i(t.label,this.regexp);return e||s?{...t,highlightedName:e||t.name,highlightedLabel:s||t.label}:[]}));return{status:`${e.length} matched prefabs`,matched:e}}}class o{constructor(t,e,s){this.regexp=t,this.blockPrefabIndex=e,this.labels=s}match(t){const e=this.matchBlocks();if(0===e.length)return{status:"No matched blocks",matched:[]};const s=this.matchPrefabTypes(e);if(0===Object.keys(s).length)return{status:`No prefabs, ${e.length} matched blocks`,matched:[]};const a=t.flatMap((t=>{const e=s[t.name];return e?{...t,matchedBlocks:e}:[]}));return{status:`${a.length} prefabs, ${e.length} matched blocks`,matched:a}}matchBlocks(){return Object.entries(this.blockPrefabIndex).reduce(((t,[e,s])=>{const a=i(e,this.regexp),n=this.labels[e],r=n&&i(n,this.regexp);return a||r?t.concat({name:e,highlightedName:a||e,highlightedLabel:r||n,prefabs:s}):t}),[])}matchPrefabTypes(t){return t.reduce(((t,e)=>{const{name:s,highlightedName:a,highlightedLabel:n}=e;return e.prefabs?.forEach((e=>{const r={name:s,highlightedName:a,highlightedLabel:n,count:e.count};t[e.name]=(t[e.name]||[]).concat(r)})),t}),{})}}},847:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.throttledInvoker=void 0;const a=s(726);e.throttledInvoker=function(t){const e=[];return()=>{switch(e.length){case 0:return e.push((async()=>{await t(),e.shift()})()),e[0];case 1:{const s=e[0];return e.push((async()=>{await s,await(0,a.waitAnimationFrame)(),await t(),e.shift()})()),e[1]}case 2:return e[1];default:throw Error(`Unexpected state: promiceses=${e.length}`)}}}},726:(t,e)=>{function s(t,e=(()=>`Unexpected state: ${t}`)){if(null!=t)return t;throw Error(e())}function a(t,e,s=(()=>`Unexpected type: ${t}`)){if(t instanceof e)return t;throw Error(s())}function n(t){return{type:"game",...t}}function r(t,e,s){const a=t.offsetX*e.width/s.width,r=t.offsetY*e.height/s.height;if(a<0||a>=e.width||r<0||r>=e.height)return null;const i=a-Math.floor(e.width/2),l=Math.floor(e.height/2)-r;return n({x:Math.round(i),z:Math.round(l)})}Object.defineProperty(e,"__esModule",{value:!0}),e.threePlaneSize=e.canvasEventToGameCoords=e.gameCoords=e.gameMapSize=e.sleep=e.imageBitmapToPngBlob=e.downloadCanvasPng=e.formatCoords=e.waitAnimationFrame=e.humanreadableDistance=e.removeAllChildren=e.component=e.requireType=e.requireNonnull=void 0,e.requireNonnull=s,e.requireType=a,e.component=function(t,e){const n=s(document.getElementById(s(t,(()=>`Element ID must not null: ${t}`))),(()=>`Element not found: #${t}`));return e?a(n,e):n},e.removeAllChildren=function(t){for(;t.lastChild;)t.removeChild(t.lastChild)},e.humanreadableDistance=function(t){return t<1e3?`${t}m`:`${(t/1e3).toFixed(2)}km`},e.waitAnimationFrame=function(){return new Promise((t=>requestAnimationFrame(t)))},e.formatCoords=function(t,e,s,a){if(!a)return"E/W: -, N/S: -, Elev: -";const n=r(a,t,e);if(null===n)return"E/W: -, N/S: -, Elev: -";const i=s(n,t)??"-";return`E/W: ${n.x}, N/S: ${n.z}, Elev: ${i}`},e.downloadCanvasPng=function(t,e){const s=document.createElement("a");s.download=t,s.href=e.toDataURL("image/png"),s.click()},e.imageBitmapToPngBlob=async function(t){const e=new OffscreenCanvas(t.height,t.width);return s(e.getContext("2d")).drawImage(t,0,0),await e.convertToBlob({type:"image/png"})},e.sleep=async function(t){return new Promise((e=>setTimeout(e,t)))},e.gameMapSize=function(t){return{type:"game",...t}},e.gameCoords=n,e.canvasEventToGameCoords=r,e.threePlaneSize=function(t,e){return{type:"threePlane",width:t,height:e}}},770:function(t,e,s){var a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const n=new(a(s(17)).default);async function r(t){return(await fetch(t)).json()}Promise.all([(async()=>n.prefabLabels=await r("../prefab-labels.json"))(),(async()=>n.blockPrefabIndex=await r("../block-prefab-index.json"))(),(async()=>n.blockLabels=await r("../block-labels.json"))()]).then((()=>n.update())),onmessage=({data:t})=>{Object.assign(n,t).update()},n.addUpdateListener((t=>postMessage(t)))}},e={};!function s(a){var n=e[a];if(void 0!==n)return n.exports;var r=e[a]={exports:{}};return t[a].call(r.exports,r,r.exports,s),r.exports}(770)})();
//# sourceMappingURL=prefabs-filter.js.map