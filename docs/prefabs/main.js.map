{
  "version": 3,
  "sources": ["../../src/lib/labels.ts", "../../src/lib/utils.ts", "../../src/lib/label-handler.ts", "../../src/prefabs/main.ts"],
  "sourcesContent": ["export const LANGUAGES = [\n  \"english\",\n  \"german\",\n  \"spanish\",\n  \"french\",\n  \"italian\",\n  \"japanese\",\n  \"koreana\",\n  \"polish\",\n  \"brazilian\",\n  \"russian\",\n  \"turkish\",\n  \"schinese\",\n  \"tchinese\",\n] as const;\nexport type Language = (typeof LANGUAGES)[number];\n\nconst LANGUAGE_TAGS: { [tag: string]: Language } = {\n  en: \"english\",\n  de: \"german\",\n  es: \"spanish\",\n  fr: \"french\",\n  it: \"italian\",\n  ja: \"japanese\",\n  ko: \"koreana\",\n  pl: \"polish\",\n  pt: \"brazilian\",\n  ru: \"russian\",\n  tr: \"turkish\",\n  \"zh-CN\": \"schinese\",\n  \"zh-TW\": \"tchinese\",\n};\n\nexport class LabelHolder {\n  static DEFAULT_LANGUAGE: Language = \"english\";\n\n  private baseUrl: string;\n  private defaultBlocks: Promise<Map<string, string>>;\n  private defaultPrefabs: Promise<Map<string, string>>;\n\n  #language: Language;\n  #blocks: Promise<Labels>;\n  #prefabs: Promise<Labels>;\n\n  constructor(baseUrl: string, navigatorLanguages: readonly string[]) {\n    this.baseUrl = baseUrl;\n    this.#language = resolveLanguage(navigatorLanguages);\n    this.defaultBlocks = this.fetchLabelMap(LabelHolder.DEFAULT_LANGUAGE, \"blocks.json\");\n    this.defaultPrefabs = this.fetchLabelMap(LabelHolder.DEFAULT_LANGUAGE, \"prefabs.json\");\n    this.#blocks = this.buildLabels(this.defaultBlocks, \"blocks.json\");\n    this.#prefabs = this.buildLabels(this.defaultPrefabs, \"prefabs.json\");\n  }\n\n  get blocks(): Promise<Labels> {\n    return this.#blocks;\n  }\n\n  get prefabs(): Promise<Labels> {\n    return this.#prefabs;\n  }\n\n  set language(lang: Language) {\n    if (lang === this.#language) return;\n    console.log(\"LabelHolder set language: %s -> %s\", this.#language, lang);\n    this.#language = lang;\n    this.#blocks = this.buildLabels(this.defaultBlocks, \"blocks.json\");\n    this.#prefabs = this.buildLabels(this.defaultPrefabs, \"prefabs.json\");\n  }\n\n  async buildLabels(defaultLabels: Promise<Map<string, string>>, fileName: string): Promise<Labels> {\n    return new Labels(await this.fetchLabelMap(this.#language, fileName), await defaultLabels);\n  }\n\n  async fetchLabelMap(language: Language, fileName: string): Promise<Map<string, string>> {\n    return new Map(Object.entries(await fetchJson<Labels>(`${this.baseUrl}/${language}/${fileName}`)));\n  }\n}\n\nexport class Labels {\n  labels: Map<string, string>;\n  defaultLabels: Map<string, string>;\n\n  constructor(labels: Map<string, string>, defaultLabels: Map<string, string>) {\n    this.labels = labels;\n    this.defaultLabels = defaultLabels;\n  }\n\n  get(key: string): string | undefined {\n    return this.labels.get(key) ?? this.defaultLabels.get(key);\n  }\n}\n\nexport function resolveLanguage(languages: readonly string[]): Language {\n  for (const clientTag of languages) {\n    for (const [tag, lang] of Object.entries(LANGUAGE_TAGS)) {\n      if (clientTag.startsWith(tag)) return lang;\n    }\n  }\n  return LabelHolder.DEFAULT_LANGUAGE;\n}\n\nasync function fetchJson<T>(path: string): Promise<T> {\n  return (await fetch(path)).json() as T;\n}\n", "export function requireNonnull<T>(t: T | undefined | null, errorMessage = () => `Unexpected state: ${String(t)}`): T {\n  if (t == null) throw Error(errorMessage());\n  return t;\n}\n\nexport function strictParseInt(s: string | undefined | null, errorMessage = () => `Unexpected argument: ${String(s)}`): number {\n  const n = parseInt(s ?? \"\");\n  if (isNaN(n)) throw Error(errorMessage());\n  return n;\n}\n\nexport function requireType<T>(o: unknown, t: new (...a: unknown[]) => T, errorMessage = () => `Unexpected type: ${String(o)}`): T {\n  if (o instanceof t) return o;\n  throw Error(errorMessage());\n}\n\nexport function component<T extends HTMLElement = HTMLElement>(id: string | undefined | null, t?: new (...a: unknown[]) => T): T {\n  const i = requireNonnull(id, () => \"Unexpected argument: id is null\");\n  const e = requireNonnull(document.getElementById(i), () => `Element not found: #${i}`);\n  return t ? requireType(e, t) : (e as T);\n}\n\nexport function removeAllChildren(e: HTMLElement): void {\n  while (e.lastChild) e.removeChild(e.lastChild);\n}\n\nexport function humanreadableDistance(d: number): string {\n  if (d < 1000) {\n    return `${d.toString()}m`;\n  }\n  return `${(d / 1000).toFixed(2)}km`;\n}\n\nexport function waitAnimationFrame(): Promise<number> {\n  return new Promise((r) => requestAnimationFrame(r));\n}\n\ninterface EventOffsets {\n  offsetX: number;\n  offsetY: number;\n}\n\nexport function formatCoords(\n  map: GameMapSize,\n  canvas: HTMLCanvasElement,\n  elevation: (coods: GameCoords, mapSize: GameMapSize) => number | null,\n  event: EventOffsets | null,\n): string {\n  if (!event) return \"E/W: -, N/S: -, Elev: -\";\n\n  const gameCoords = canvasEventToGameCoords(event, map, canvas);\n  if (gameCoords === null) {\n    return \"E/W: -, N/S: -, Elev: -\";\n  }\n\n  const y = elevation(gameCoords, map) ?? \"-\";\n  return `E/W: ${gameCoords.x.toString()}, N/S: ${gameCoords.z.toString()}, Elev: ${y.toString()}`;\n}\n\nexport function downloadCanvasPng(fileName: string, canvas: HTMLCanvasElement): void {\n  const a = document.createElement(\"a\");\n  a.download = fileName;\n  a.href = canvas.toDataURL(\"image/png\");\n  a.click();\n}\n\nexport async function imageBitmapToPngBlob(img: ImageBitmap): Promise<PngBlob> {\n  const canvas = new OffscreenCanvas(img.height, img.width);\n  const context = requireNonnull(canvas.getContext(\"2d\"));\n  context.drawImage(img, 0, 0);\n  return (await canvas.convertToBlob({ type: \"image/png\" })) as PngBlob;\n}\n\nexport async function sleep(msec: number): Promise<void> {\n  return new Promise((r) => setTimeout(r, msec));\n}\n\nexport function gameMapSize(s: { width: number; height: number }): GameMapSize {\n  return { type: \"game\", ...s };\n}\n\nexport function gameCoords(c: { x: number; z: number }): GameCoords {\n  return { type: \"game\", ...c };\n}\n\n/** Returns null if the event was fired out of the canvas */\nexport function canvasEventToGameCoords(event: EventOffsets, mapSize: GameMapSize, canvasSize: HTMLCanvasElement): GameCoords | null {\n  // in-game scale coords with left-top offset\n  const gx = (event.offsetX * mapSize.width) / canvasSize.width;\n  const gz = (event.offsetY * mapSize.height) / canvasSize.height;\n  if (gx < 0 || gx >= mapSize.width || gz < 0 || gz >= mapSize.height) {\n    return null;\n  }\n\n  // in-game coords (center offset)\n  const x = gx - Math.floor(mapSize.width / 2);\n  const z = Math.floor(mapSize.height / 2) - gz;\n  return gameCoords({ x: Math.round(x), z: Math.round(z) });\n}\n\nexport function threePlaneSize(width: number, height: number): ThreePlaneSize {\n  return { type: \"threePlane\", width, height };\n}\n\nexport function printError(e: unknown): void {\n  console.error(e);\n}\n\nexport async function fetchJson<T>(url: string): Promise<T> {\n  return (await (await fetch(url)).json()) as T;\n}\n\nexport async function invokeAll<T>(fns: ((t: T) => unknown)[], t: T): Promise<void> {\n  await Promise.all(fns.map((fn) => fn(t)));\n}\n", "import { LANGUAGES, Language, resolveLanguage } from \"./labels\";\nimport { printError } from \"./utils\";\n\ninterface Doms {\n  language: HTMLSelectElement;\n}\n\nexport class LabelHandler {\n  private doms: Doms;\n  private listener: ((lang: Language) => void | Promise<void>)[] = [];\n\n  constructor(doms: Doms, navigatorLanguages: readonly string[]) {\n    this.doms = doms;\n    this.buildSelectOptions(navigatorLanguages);\n    this.doms.language.addEventListener(\"change\", () => {\n      this.listener.forEach((fn) => {\n        fn(this.doms.language.value as Language)?.catch(printError);\n      });\n    });\n  }\n\n  private buildSelectOptions(navigatorLanguages: readonly string[]) {\n    const existingLangs = new Set(Array.from(this.doms.language.options).map((o) => o.value));\n    for (const lang of LANGUAGES) {\n      if (existingLangs.has(lang)) {\n        continue;\n      }\n      const option = document.createElement(\"option\");\n      option.textContent = lang;\n      this.doms.language.appendChild(option);\n    }\n\n    const browserLang = resolveLanguage(navigatorLanguages);\n    if (this.doms.language.value !== browserLang) {\n      this.doms.language.value = resolveLanguage(navigatorLanguages);\n      requestAnimationFrame(() => this.doms.language.dispatchEvent(new Event(\"change\")));\n    }\n  }\n\n  addListener(fn: (lang: Language) => void | Promise<void>) {\n    this.listener.push(fn);\n  }\n}\n", "import { LabelHandler } from \"../lib/label-handler\";\nimport { LabelHolder, Labels } from \"../lib/labels\";\nimport { component } from \"../lib/utils\";\n\nfunction main() {\n  const labelHolder = new LabelHolder(\"../labels\", navigator.languages);\n  const labelHandler = new LabelHandler({ language: component(\"label_lang\", HTMLSelectElement) }, navigator.languages);\n  labelHandler.addListener(async (lang) => {\n    labelHolder.language = lang;\n    updatePrefabLabels(await labelHolder.prefabs);\n    udpateBlockLabels(await labelHolder.blocks);\n  });\n}\n\nfunction updatePrefabLabels(labels: Labels) {\n  const name = document.querySelector(\".prefab_name\")?.textContent?.trim();\n  if (!name) return;\n  const labelEl = document.querySelector(\".prefab_label\");\n  if (!labelEl) return;\n  labelEl.textContent = labels.get(name) ?? \"-\";\n}\n\nfunction udpateBlockLabels(labels: Labels) {\n  for (const blockEl of component(\"blocks\", HTMLElement).querySelectorAll(\".block\")) {\n    const name = blockEl.querySelector(\".block_name\")?.textContent?.trim();\n    if (!name) continue;\n    const labelEl = blockEl.querySelector(\".block_label\");\n    if (!labelEl) continue;\n    labelEl.textContent = labels.get(name) ?? \"-\";\n  }\n}\n\nif (document.readyState === \"loading\") {\n  document.addEventListener(\"DOMContentLoaded\", main);\n} else {\n  main();\n}\n"],
  "mappings": "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",
  "names": ["LANGUAGES", "LANGUAGE_TAGS", "LabelHolder", "_LabelHolder", "#language", "#blocks", "#prefabs", "baseUrl", "navigatorLanguages", "resolveLanguage", "lang", "defaultLabels", "fileName", "Labels", "language", "fetchJson", "labels", "key", "languages", "clientTag", "tag", "path", "requireNonnull", "errorMessage", "requireType", "o", "t", "errorMessage", "component", "id", "i", "requireNonnull", "e", "printError", "e", "LabelHandler", "doms", "navigatorLanguages", "fn", "printError", "existingLangs", "o", "lang", "LANGUAGES", "option", "browserLang", "resolveLanguage", "main", "labelHolder", "LabelHolder", "LabelHandler", "component", "lang", "updatePrefabLabels", "udpateBlockLabels", "labels", "name", "labelEl", "blockEl"]
}
